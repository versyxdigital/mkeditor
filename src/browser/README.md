# MKEditor Web App (Renderer)

This folder contains the renderer (browser) side of MKEditor: the Monaco editor, markdown preview, UI components, and the localization/runtime that also powers the desktop UI. The renderer can run in two modes: pure web or desktop (Electron) with a bridge.

## Structure Overview

- `index.ts`: Composition root. Detects runtime, initializes i18n, creates the editor, registers providers, and activates UI helpers.
- `i18n.ts`: Localization: loads language bundles, normalizes locale, applies translations, and exposes `t()`.
- `icons.ts`: Registers FontAwesome icons and observes DOM for icon placeholders.
- `version.ts`: Build-generated version constant used by the UI.
- `config.ts`: Default `EditorSettings` and `ExportSettings`.
- `dom.ts`: Centralized DOM refs and UI helpers (splash fade, split panels, Bootstrap tooltips, properties modal).
- `util.ts`: Utilities (debounce, OS detection, execution bridge detection, locale helpers).
- `views/index.html`: Base HTML for the renderer runtime.
- `assets/`: Static assets and styles.
- `core/`: Editor orchestration and runtime plumbing
  - `EditorManager.ts`: Creates Monaco, renders markdown, wires events and providers, drives preview.
  - `FileManager.ts`, `FileTreeManager.ts`: Tabbed files/models and explorer tree handling.
  - `BridgeManager.ts`: Desktop-only orchestrator around the execution bridge.
  - `BridgeListeners.ts`: Subscribes to `from:*` channels; syncs settings/theme/files, shows notifications.
  - `ToolbarListeners.ts`: Registers toolbar event listeners and actions.
  - `mappings/`: Command and explorer context‑menu mappings.
  - `completion/`: Data/logic for completions (lists, fenced blocks, etc.).
- `events/`: Lightweight event/dispatcher system used inside the renderer.
- `interfaces/`: Provider/editor/bridge/dispatcher interfaces.
- `extensions/`: Editor/markdown renderer extensions (e.g., ScrollSync).

## Runtime Modes & Bridge Model

`index.ts` uses `getExecutionBridge()` (from `util.ts`) to detect mode:
- Web mode: returns `'web'`; the file‑tree sidebar is hidden and settings persist to `localStorage`.
- Desktop mode: returns the bridge object created in the Electron preload; the renderer can `send`/`receive` on whitelisted IPC channels.

Renderer perspective of bridge channels (selected):
- Send (`to:*`): `to:file:*`, `to:folder:*`, `to:settings:save`, `to:html:export`, `to:pdf:export`, `to:i18n:set`.
- Receive (`from:*`): `from:file:*`, `from:folder:*`, `from:settings:set`, `from:theme:set`, `from:notification:display`, `from:path:*`.

## i18n Model & Namespaces

- Namespaces loaded include: `app`, `navbar`, `sidebar`, `toolbar`, `menus-explorer`, `menus-codeblocks`, `menus-alerts`, `menus-tables`, `modals-settings`, `modals-export`, `modals-about`, `modals-shortcuts`, `modals-unsaved`, `modals-properties`, and `notifications`.
- Bundling: per-language `all.json` is generated by `scripts/combine-locales.mjs`. At runtime, the loader prefers `all.json` and falls back to individual JSON files in parallel when needed. Missing namespaces are supplemented dynamically, and English fallbacks are ensured for `notifications`.
- Performance: language fetches are cached/deduped, bindings are precomputed in one DOM pass, and translations apply synchronously for minimal paint delay.
- Usage: call `t('namespace:key', values?)`. The bridge listener translates `from:notification:display` payloads when `key` is provided.

## Build & Run

- Build the renderer bundle: `npm run build-editor` (generates `version.ts`, combines locales, and runs webpack to produce `dist/mkeditor.bundle.js`).
- Run the web demo: `npm run serve-web` (serves `dist/`).
- Run the desktop app: `npm run serve-app` (after `build-editor`; launches Electron with the compiled main process).

## Lifecycle Highlights

1. `icons.ts` registers icons.
2. i18n initializes and applies the user locale (with prefetch + HTML `lang` set early).
3. `EditorDispatcher` and `EditorManager` spin up Monaco + preview.
4. Providers are attached: `SettingsProvider`, `ExportSettingsProvider`, `CommandProvider`, `CompletionProvider`.
5. Desktop only: `BridgeManager` + `BridgeListeners` connect IPC (theme, settings, notifications, file events, mked:// links).
6. UI helpers: draggable editor/preview split (with reset), sidebar toggle, Bootstrap tooltips, and a splash fade.


